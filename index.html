<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cappuccino Spark ‚Äî Qu·∫£n L√Ω Nh√¢n S·ª±</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
:root {
  --brand:#4a2c2a; 
  --accent:#ffb347;
  --primary:#0d6efd; 
  --success:#28a745; 
  --danger:#dc3545;
  --muted:#6c757d; 
  --card:#f9f9fb;
  --bg1:#f0ede9; 
  --bg2:#d8e7f1;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: "Segoe UI", Inter, system-ui;
  background: linear-gradient(135deg,var(--bg1),var(--bg2));
  color: #222;
  min-height: 100vh;
  overflow-x: hidden;
}

header {
  position: sticky;
  top: 0;
  z-index: 10;
  background: rgba(255,255,255,.95);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid #eee;
}

.topbar {
  max-width: 1200px;
  margin: auto;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 12px 16px;
}

.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 700;
  color: var(--brand);
}

.brand svg {
  width: 32px;
  height: 32px;
}

.container {
  width: 100%;
  max-width: 1200px;
  margin: 16px auto;
  padding: 0 16px;
}

input, select, button {
  font-size: 15px;
  border-radius: 8px;
}

input, select {
  padding: 10px 12px;
  border: 1px solid #d0d7de;
  width: 100%;
}

button {
  padding: 10px 14px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.btn { background: #e9ecef; color:#222; }
.btn-primary { background: var(--primary); color: #fff; }
.btn-success { background: var(--success); color: #fff; }
.btn-danger { background: var(--danger); color: #fff; }
.btn-outline { background:#fff; border:1px solid #d0d7de; }

.toolbar {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 12px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px;
}

.card {
  background: #fff;
  border: 1px solid #eceff3;
  border-radius: 14px;
  box-shadow: 0 6px 20px rgba(0,0,0,.05);
  overflow: hidden;
  transition: transform .2s ease;
}

.card:hover {
  transform: scale(1.02);
}

.card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
  background: #eee;
}

.card .body p {
  margin: 4px 0;
  word-wrap: break-word;
}

.panel {
  background: var(--card);
  border: 1px solid #eceff3;
  border-radius: 14px;
  padding: 14px;
  margin-bottom: 16px;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
  gap: 10px;
}

.muted {
  color: var(--muted);
  font-size: 13px;
}

.hidden {
  display: none !important;
}

/* LOGIN OVERLAY */
.overlay {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg,#2b2b2b,#1c1c1c);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99;
  padding: 16px;
}

.login {
  width: 100%;
  max-width: 380px;
  background: #fff;
  border-radius: 16px;
  padding: 22px;
  box-shadow: 0 12px 40px rgba(0,0,0,.25);
}

/* RESPONSIVE ADJUSTMENTS */
@media (max-width: 1024px) {
  .topbar { flex-direction: column; align-items: stretch; }
  .toolbar { flex-direction: column; }
}

@media (max-width: 768px) {
  .brand svg { width: 28px; height: 28px; }
  .form-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
  .toolbar button, .toolbar input { width: 100%; }
  .btn, .btn-primary, .btn-success, .btn-outline { width: 100%; }
}

@media (max-width: 480px) {
  body { font-size: 15px; }
  header input, header button { width: 100%; }
  .form-grid { grid-template-columns: 1fr; }
  .grid { grid-template-columns: 1fr; }
  .card img { height: 150px; }
  .topbar { padding: 10px; }
  .login { padding: 18px; width: 95%; }
}
</style>

</head>
<body>

<!-- ƒêƒÉng nh·∫≠p -->
<div class="overlay" id="gate">
  <div class="login">
    <div class="brand">
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
        <path fill="var(--brand)" d="M10 42c0 6 7 11 22 11s22-5 22-11V22H10v20Z"/>
        <path fill="var(--accent)" d="M54 22c4 0 7 3 7 7s-3 7-7 7h-4V22h4Z"/>
        <path fill="#fff" d="M12 18c3-5 12-8 20-8s17 3 20 8H12Z"/>
      </svg>
      <span>Cappuccino Spark</span>
    </div>
    <h3>ƒêƒÉng nh·∫≠p</h3>
    <input id="pw" type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." style="width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc">
    <button class="btn-primary" style="width:100%" onclick="login()">V√†o h·ªá th·ªëng</button>
    <p class="muted">M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh: <b>123456</b></p>
  </div>
</div>

<header>
  <div class="topbar">
    <div class="brand">
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
        <path fill="var(--brand)" d="M10 42c0 6 7 11 22 11s22-5 22-11V22H10v20Z"/>
        <path fill="var(--accent)" d="M54 22c4 0 7 3 7 7s-3 7-7 7h-4V22h4Z"/>
        <path fill="#fff" d="M12 18c3-5 12-8 20-8s17 3 20 8H12Z"/>
      </svg>
      <span>Cappuccino Spark</span>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
      <input id="oldPw" type="password" placeholder="M·∫≠t kh·∫©u hi·ªán t·∫°i">
      <input id="newPw" type="password" placeholder="M·∫≠t kh·∫©u m·ªõi">
      <button class="btn-primary" onclick="changePassword()"><i class="fa fa-key"></i> ƒê·ªïi</button>
    </div>
  </div>
</header>

<main class="container hidden" id="app">
  <div class="toolbar">
    <input id="search" type="text" placeholder="T√¨m theo t√™n, v·ªã tr√≠, qu√™ qu√°n, email, sƒët‚Ä¶" />
    <button class="btn" id="btnSearch"><i class="fa fa-search"></i> T√¨m</button>
    <button class="btn-outline" id="btnShowAll"><i class="fa fa-list"></i> Hi·ªÉn th·ªã t·∫•t c·∫£</button>
    <button class="btn-success" id="toggleForm"><i class="fa fa-plus"></i> Th√™m nh√¢n vi√™n</button>
  </div>

  <section id="formPanel" class="panel hidden">
    <h3>Th√™m / C·∫≠p nh·∫≠t nh√¢n vi√™n</h3>
    <div class="form-grid">
      <input id="empId" type="text" placeholder="M√£ nh√¢n vi√™n *" />
      <input id="name" type="text" placeholder="H·ªç v√† t√™n *" />
      <select id="gender">
        <option value="">Gi·ªõi t√≠nh *</option>
        <option>Nam</option><option>N·ªØ</option><option>Kh√°c</option>
      </select>
      <input id="year" type="number" placeholder="NƒÉm sinh *" />
      <input id="position" type="text" placeholder="V·ªã tr√≠ *" />
      <input id="hometown" type="text" placeholder="Qu√™ qu√°n *" />
      <input id="address" type="text" placeholder="N∆°i ·ªü hi·ªán t·∫°i *" />
      <input id="startDate" type="date" placeholder="Ng√†y v√†o l√†m *" />
      <input id="phone" type="text" placeholder="S·ªë ƒëi·ªán tho·∫°i *" />
      <input id="email" type="email" placeholder="Email *" />
      <input id="specialty" type="text" placeholder="M√≥n s·ªü tr∆∞·ªùng (t√πy ch·ªçn)" />
      <button class="btn-success" onclick="saveEmployee()"><i class="fa fa-save"></i> L∆∞u</button>
    </div>
    <p class="muted">(*) B·∫Øt bu·ªôc. NƒÉm sinh ph·∫£i h·ª£p l√Ω, nƒÉm v√†o l√†m > nƒÉm sinh + 18.</p>
  </section>

  <section class="panel">
    <div class="form-grid" style="grid-template-columns:repeat(5,1fr)">
      <input id="filterYearStart" type="number" placeholder="NƒÉm v√†o l√†m (VD: 2020)">
      <input id="filterBirthYear" type="number" placeholder="NƒÉm sinh (VD: 1998)">
      <select id="filterGender"><option value="">Gi·ªõi t√≠nh (all)</option><option>Nam</option><option>N·ªØ</option><option>Kh√°c</option></select>
      <select id="filterAddress"><option value="">N∆°i ·ªü (all)</option></select>
      <select id="filterPosition"><option value="">V·ªã tr√≠ (all)</option></select>
    </div>
    <button class="btn" id="btnApplyFilter" style="margin-top:10px"><i class="fa fa-filter"></i> L·ªçc</button>
  </section>

  <section class="grid" id="list"></section>
</main>

<script>
const $ = id => document.getElementById(id);

let employees = [];
let password = '123456';

// ‚úÖ Kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ localStorage (n·∫øu c√≥)
if (localStorage.getItem('hr_employees'))
  employees = JSON.parse(localStorage.getItem('hr_employees') || '[]');
if (localStorage.getItem('hr_password'))
  password = localStorage.getItem('hr_password');

// ‚úÖ L∆∞u d·ªØ li·ªáu v√†o localStorage (n·∫øu tr√¨nh duy·ªát h·ªó tr·ª£)
function persist() {
  try {
    localStorage.setItem('hr_employees', JSON.stringify(employees));
    localStorage.setItem('hr_password', password);
  } catch (e) {
    console.warn("localStorage not available, consider using export JSON");
  }
}

// üîí ƒêƒÉng nh·∫≠p
function login() {
  const pw = $('pw').value.trim();
  if (pw === password) {
    $('gate').classList.add('hidden');
    $('app').classList.remove('hidden');
    renderAll();
  } else alert('Sai m·∫≠t kh·∫©u!');
}

// üîë ƒê·ªïi m·∫≠t kh·∫©u
function changePassword() {
  const oldPw = $('oldPw').value.trim(),
        newPw = $('newPw').value.trim();
  if (oldPw !== password) return alert('M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng!');
  if (!newPw || newPw.length < 6) return alert('M·∫≠t kh·∫©u m·ªõi ph·∫£i >=6 k√Ω t·ª±!');
  password = newPw;
  persist();
  $('oldPw').value = $('newPw').value = '';
  alert('ƒê√£ ƒë·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!');
}

// üíæ L∆∞u nh√¢n vi√™n
async function saveEmployee() {
  const idVal = $('empId').value.trim();
  const emp = {
    empId: idVal,
    name: $('name').value.trim(),
    gender: $('gender').value.trim(),
    year: +$('year').value.trim(),
    position: $('position').value.trim(),
    hometown: $('hometown').value.trim(),
    address: $('address').value.trim(),
    startDate: $('startDate').value,
    phone: $('phone').value.trim(),
    email: $('email').value.trim(),
    specialty: $('specialty').value.trim()
  };
  const now = new Date().getFullYear();
  if (!emp.empId || !emp.name || !emp.gender || !emp.year || !emp.position || !emp.address || !emp.startDate || !emp.phone || !emp.email)
    return alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc!');
  if (emp.year > now || emp.year < 1900) return alert('NƒÉm sinh kh√¥ng h·ª£p l·ªá!');
  const startYear = new Date(emp.startDate).getFullYear();
  if (startYear > now) return alert('NƒÉm v√†o l√†m kh√¥ng ƒë∆∞·ª£c l·ªõn h∆°n nƒÉm hi·ªán t·∫°i!');
  if (startYear <= emp.year + 18) return alert('NƒÉm v√†o l√†m ph·∫£i l·ªõn h∆°n nƒÉm sinh √≠t nh·∫•t 18 nƒÉm!');
  if (!/^[0-9]{10}$/.test(emp.phone)) return alert('SƒêT ph·∫£i c√≥ 10 ch·ªØ s·ªë!');
  if (!emp.email.includes('@')) return alert('Email kh√¥ng h·ª£p l·ªá!');

  const existing = employees.findIndex(e => e.empId.toLowerCase() === idVal.toLowerCase());
  if (existing >= 0) {
    employees[existing] = emp;
    alert('C·∫≠p nh·∫≠t nh√¢n vi√™n th√†nh c√¥ng!');
  } else {
    employees.push(emp);
    alert('Th√™m nh√¢n vi√™n th√†nh c√¥ng!');
  }
  persist();
  renderAll();
  $('formPanel').classList.add('hidden');
}

// üóëÔ∏è X√≥a nh√¢n vi√™n
function editEmployee(i) {
  const e = employees[i];
  for (const k in e) { if ($(k)) $(k).value = e[k] || ''; }
  $('formPanel').classList.remove('hidden');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function deleteEmployee(i) {
  if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a nh√¢n vi√™n n√†y?')) {
    employees.splice(i, 1);
    persist();
    renderAll();
  }
}

// üß© Dropdown ƒë·ªông
function buildDropdowns() {
  const posSet = new Set(), addrSet = new Set();
  employees.forEach(e => {
    if (e.position) posSet.add(e.position.trim());
    if (e.address) {
      const parts = e.address.split(',').map(x => x.trim());
      addrSet.add(parts[parts.length - 1].toLowerCase());
    }
  });
  $('filterPosition').innerHTML =
    '<option value="">V·ªã tr√≠ (all)</option>' +
    [...posSet].map(v => `<option>${v}</option>`).join('');
  $('filterAddress').innerHTML =
    '<option value="">N∆°i ·ªü (all)</option>' +
    [...addrSet].map(v => `<option>${v.charAt(0).toUpperCase() + v.slice(1)}</option>`).join('');
}

// üîç L·ªçc
function applyFilter(list) {
  const q = $('search').value.trim().toLowerCase();
  if (!q) return list;
  return list.filter(e => Object.values(e).join(' ').toLowerCase().includes(q));
}
function applyAdvancedFilter(list) {
  const yStart = $('filterYearStart').value.trim();
  const yBirth = $('filterBirthYear').value.trim();
  const g = $('filterGender').value.trim().toLowerCase();
  const addr = $('filterAddress').value.trim().toLowerCase();
  const pos = $('filterPosition').value.trim().toLowerCase();
  return list.filter(e => {
    if (yStart && new Date(e.startDate).getFullYear() != +yStart) return false;
    if (yBirth && e.year != +yBirth) return false;
    if (g && e.gender.toLowerCase() != g) return false;
    if (addr && !e.address.toLowerCase().includes(addr)) return false;
    if (pos && e.position.toLowerCase() != pos) return false;
    return true;
  });
}

// üßæ Hi·ªÉn th·ªã danh s√°ch
function renderList(list) {
  const target = $('list');
  target.innerHTML = '';
  if (!list.length)
    return target.innerHTML = '<p style="text-align:center;color:gray">Kh√¥ng c√≥ nh√¢n vi√™n n√†o.</p>';
  list.forEach((e, i) => {
    target.insertAdjacentHTML('beforeend', `
      <article class="card">
        <img src="https://via.placeholder.com/400x240?text=Avatar">
        <div class="body" style="padding:10px 14px">
          <h3>${e.name}</h3>
          <p><b>Gi·ªõi t√≠nh:</b> ${e.gender}</p>
          <p><b>NƒÉm sinh:</b> ${e.year}</p>
          <p><b>V·ªã tr√≠:</b> ${e.position}</p>
          <p><b>Qu√™ qu√°n:</b> ${e.hometown}</p>
          <p><b>N∆°i ·ªü:</b> ${e.address}</p>
          <p><b>Ng√†y v√†o l√†m:</b> ${e.startDate}</p>
          <p><b>SƒêT:</b> ${e.phone}</p>
          <p><b>Email:</b> ${e.email}</p>
          <p><b>S·ªü tr∆∞·ªùng:</b> ${e.specialty || '‚Äî'}</p>
        </div>
        <div class="actions" style="display:flex;gap:6px;padding:10px">
          <button class="btn-outline" onclick="editEmployee(${i})"><i class="fa fa-pen"></i> S·ª≠a</button>
          <button class="btn-danger" onclick="deleteEmployee(${i})"><i class="fa fa-trash"></i> X√≥a</button>
        </div>
      </article>`);
  });
}
function renderAll() {
  buildDropdowns();
  let result = applyFilter(employees);
  result = applyAdvancedFilter(result);
  renderList(result);
}

// üìÇ Xu·∫•t & nh·∫≠p d·ªØ li·ªáu JSON
function exportData() {
  const blob = new Blob([JSON.stringify({ password, employees }, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'nhansu_data.json';
  a.click();
  URL.revokeObjectURL(url);
}
function importData(ev) {
  const file = ev.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const data = JSON.parse(reader.result);
      if (data.employees) employees = data.employees;
      if (data.password) password = data.password;
      persist();
      alert('ƒê√£ t·∫£i d·ªØ li·ªáu th√†nh c√¥ng!');
      renderAll();
    } catch {
      alert('File kh√¥ng h·ª£p l·ªá!');
    }
  };
  reader.readAsText(file);
}

// üîò G√°n s·ª± ki·ªán
$('btnSearch').onclick = renderAll;
$('search').addEventListener('keydown', e => { if (e.key === 'Enter') renderAll(); });
$('btnShowAll').onclick = () => {
  $('search').value = '';
  ['filterYearStart', 'filterBirthYear', 'filterGender', 'filterAddress', 'filterPosition']
    .forEach(id => $(id).value = '');
  renderAll();
};
$('btnApplyFilter').onclick = renderAll;
$('toggleForm').onclick = () => {
  const p = $('formPanel');
  const open = p.classList.contains('hidden');
  p.classList.toggle('hidden');
  if (open) {
    ['empId', 'name', 'gender', 'year', 'position', 'hometown', 'address', 'startDate', 'phone', 'email', 'specialty']
      .forEach(id => $(id).value = '');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
};

// ‚ûï Th√™m n√∫t xu·∫•t/nh·∫≠p JSON
window.addEventListener('DOMContentLoaded', () => {
  const bar = document.querySelector('.toolbar');
  bar.insertAdjacentHTML('beforeend', `
    <input type="file" id="fileImport" class="hidden" accept="application/json">
    <button class="btn-outline" onclick="exportData()"><i class="fa fa-download"></i> Xu·∫•t d·ªØ li·ªáu</button>
    <button class="btn-outline" onclick="$('fileImport').click()"><i class="fa fa-upload"></i> Nh·∫≠p d·ªØ li·ªáu</button>
  `);
  $('fileImport').addEventListener('change', importData);
});

renderAll();
</script>

</body>
</html>

